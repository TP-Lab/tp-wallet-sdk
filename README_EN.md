# TokenPocket SDK Wallet Protocol
#### Version：v1.0

### TokenPocket scan qrcode authorize

Use TokenPocket scan authorize qrcode, user auth this action and notify Dapp

~~~
{
    protocol	string   // protocol name
    version     string   // version 
    dappName    string   
    dappIcon    string   
    blockchain  string   //  "eos enu eth moac"
    wallet      string   // wallet name
    action      string   // neccessary here is login
    actionId    string   // uuid generated by dapp  
    callbackUrl string   // dapp callbackUrl to get login result
    expired	    string   
    memo	    string   // optional
}
~~~

- sign data
~~~
data = timestamp + wallet + actionId + ref
sign = ecc.sign(data, privateKey)
~~~


- post signed message to callbackUrl
~~~
{
    protocol  string
    version   string
    timestamp string
    sign      string //signed data
    actionId  string
    wallet    string
    ref       string
}
~~~

- DAPP server verify the message

### Pull up TokenPocket auth authorize
If the dapp does not have a authorize server, callbackUrl can be empty
- Compared with scan qrcode,the callbackSchema field is neccessary to get result

~~~
    ...
    callbackSchema    string // Dapp schema，such as：appABC://abc.com?action=login 
    the result：appABC://abc.com?action=login&result=1&param={json param} 
    result code：0 Cancel，1 Success,  2 Error
    ...
~~~

Success result
~~~
{
   "sign": "SIG_K1_KZL9eR4cCQCJHpYHbh44yGrDqu4w8hHzQwb1xTk4Mcd4czqpw4jJUgg9DnWXzE3r",
   "timestamp": "1546613919", //second
   "wallet": "eoseoseosacc", //
   "ref": "TokenPocket",
   "action":"login",
   "actionId":"ljsdjljdljf-xjlsdjfkj" 
   "publickey": "EOS2TtWv19a9eYEQYB8NbGCM28nQNngWP4UcSjVYqtEz6kF7yCnPX",
   "permissions": ["active", "owner"],
   "result": 1
}
~~~

Cancel result
~~~
{
   "action":"login",
   "actionId":"ljsdjljdljf-xjlsdjfkj" 
   "result": 0
}
~~~


### TokenPocket scan qrcode transfer token
~~~
{
    protocol    string   
    version     string   
    dappName    string   
    dappIcon    string   
    action      string   // neccessary
    actionId    string   
    blockchain  string   
    from        string   // optional 
    to          string   // neccessary
    amount      number   // neccessary
    contract    string   // neccessary
    symbol      string   // neccessary
    precision   number   // neccessary
    memo        string   // optional
    desc	    string   // optional			     
    expired	    string   // 
    callbackUrl string //optional
}
~~~

### Pull up TokenPocket transfer
- Compared with scan qrcode,the callbackSchema field is neccessary to get result
~~~
    ...
    callbackSchema    string // Dapp schema，such as：appABC://abc.com?action=transfer
    result：appABC://abc.com?action=transfer&result=0&txID=xxx&param={json param} 
    result code ：0 Cancel，1 Success,  2 ERROR
    ...
~~~

Success result
~~~
"ref": "TokenPocket",
"txID": "588c6797534d09e8e0b149c06c11bfd6ca7b96f0d4bba87700fffe7a87b0d988",
"publickey": "EOSX1tWv19a9eKEQQB8Nb2wM28nYNngWP3UcSjVYqtjz6kF7yCnQ",
"action":"transfer",
"actionId":"ljsdljf-xljlsdjfl" 
"wallet": "eoseoseostes",
"permissions": ["active", "owner"],
"result": 1 
~~~

Cancel result
~~~
"action":"transfer",
"actionId":"ljsdljf-xljlsdjfl" 
"result": 0
~~~


### TokenPocket scan qrcode push actions
~~~
    protocol    string   
    version     string   
    dappName    string   
    dappIcon    string   
    action      string   
    actionId    string   
    blockchain  string   //  "eos enu eth moac"
    actions     string   //json array each element is an action

    memo    string   // optional
    desc	    string   // optional    
    expired	    number   // seconds
    callbackUrl string //optional
~~~

### Pull up TokenPocket push actions
Compared with qrcode, callbackSchema is neccessary to get result

~~~
    ...
    callbackSchema    string     // Dapp schema，such as：appABC://abc.com?action=pushTransaction 
    result：appABC://abc.com?action=pushTransaction&result=0&txID=xxx&param={json param} 
    result code：0 CANCEL，1 SUCCESS,  2 ERROR
    ...
~~~


Success result
~~~
"ref": "TokenPocket",
"txID": "588c6797534d09e8e0b149c06c11bfd6ca7b96f0d4bba87700fffe7a87b0d988",
"publickey": "EOSX1tWv19a9eKEQQB8Nb2wM28nYNngWP3UcSjVYqtjz6kF7yCnQ",
"action":"pushTransaction",
"actionId":"ljsdljf-xljlsdjfl" 
"wallet": "eoseoseostes",
"permissions": ["active", "owner"],
"result": 1
~~~

Cancel result
~~~
"action":"pushTransaction",
"actionId":"ljsdljf-xljlsdjfl" 
"result": 0
~~~


SDK details：https://github.com/TP-Lab/Mobile-SDK
